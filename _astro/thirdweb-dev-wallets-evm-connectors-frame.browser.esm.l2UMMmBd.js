import{W as g,_ as o,a as l,g as d,n as m,e as a,f as c,R as p,c as v,b as C,k as f,l as y,Q as P,V as I,S as E,m as _}from"./Login.jzdBbfpg.js";import{g as D}from"./url-bc88b2b6.browser.esm.hY9mfG0l.js";import"./index.hfxd0CuE.js";import"./tokens.Ppa7r3iO.js";var u=new WeakMap;class S extends g{constructor(e){let{chains:t,options:s,connectorStorage:r}=e;const n={shimDisconnect:!0,...s};super({chains:t,options:n}),o(this,"id","frame"),o(this,"name","Frame"),o(this,"ready",!0),o(this,"shimDisconnectKey",`${this.id}.shimDisconnect`),l(this,u,{writable:!0,value:void 0}),o(this,"onAccountsChanged",i=>{i.length===0?this.emit("disconnect"):this.emit("change",{account:d(i[0])})}),o(this,"onChainChanged",i=>{const h=m(i),w=this.isChainUnsupported(h);this.emit("change",{chain:{id:h,unsupported:w}})}),o(this,"onDisconnect",()=>{this.emit("disconnect"),this.options.shimDisconnect&&this.connectorStorage.removeItem(this.shimDisconnectKey)}),this.connectorStorage=r}async connect(e){try{const t=await this.getProvider();if(!t)throw new a;this.setupListeners(),this.emit("message",{type:"connecting"});const s=await t.request({method:"eth_requestAccounts"}),r=d(s[0]);let n=await this.getChainId(),i=this.isChainUnsupported(n);return e?.chainId&&n!==e?.chainId&&(n=(await this.switchChain(e?.chainId)).chainId,i=this.isChainUnsupported(n)),this.options.shimDisconnect&&this.connectorStorage.setItem(this.shimDisconnectKey,"true"),{account:r,provider:t,chain:{id:n,unsupported:i}}}catch(t){throw this.isUserRejectedRequestError(t)?new c(t):t.code===-32002?new p(t):t}}async disconnect(){const e=await this.getProvider();e?.removeListener&&(e.removeListener("accountsChanged",this.onAccountsChanged),e.removeListener("chainChanged",this.onChainChanged),e.removeListener("disconnect",this.onDisconnect),this.isInjected()||e.close(),this.options.shimDisconnect&&this.connectorStorage.removeItem(this.shimDisconnectKey))}async getAccount(){const e=await this.getProvider();if(!e)throw new a;const t=await e.request({method:"eth_accounts"});return d(t[0])}async getChainId(){const e=await this.getProvider();if(!e)throw new a;const t=await e.request({method:"eth_chainId"});return m(t)}async getProvider(){return v(this,u,this.isInjected()?this.injectedProvider():await this.createProvider()),C(this,u)}async getSigner(){let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const[t,s]=await Promise.all([this.getProvider(),this.getAccount()]);return new f(t,e).getSigner(s)}async isAuthorized(){try{if(this.options.shimDisconnect&&!this.connectorStorage.getItem(this.shimDisconnectKey))return!1;if(!await this.getProvider())throw new a;return!!await this.getAccount()}catch{return!1}}async switchChain(e){const t=await this.getProvider();if(!t)throw new a;const s=y(e);try{return await Promise.all([t.request({method:"wallet_switchEthereumChain",params:[{chainId:s}]}),new Promise(r=>this.on("change",n=>{let{chain:i}=n;i?.id===e&&r()}))]),this.chains.find(r=>r.chainId===e)??{chainId:e,name:`Chain ${s}`,slug:`${s}`,nativeCurrency:{name:"Ether",decimals:18,symbol:"ETH"},rpc:[""],chain:"",shortName:"",testnet:!0}}catch(r){const n=this.chains.find(i=>i.chainId===e);if(!n)throw new P({chainId:e,connectorId:this.id});if(r.code===4902)try{if(await t.request({method:"wallet_addEthereumChain",params:[{chainId:s,chainName:n.name,nativeCurrency:n.nativeCurrency,rpcUrls:D(n),blockExplorerUrls:this.getBlockExplorerUrls(n)}]}),await this.getChainId()!==e)throw new c(new Error("User rejected switch after adding network."));return n}catch(i){throw this.isUserRejectedRequestError(i)?new c(i):new I(i.message)}throw this.isUserRejectedRequestError(r)?new c(r):new E(r)}}async watchAsset(e){let{address:t,decimals:s=18,image:r,symbol:n}=e;const i=await this.getProvider();if(!i)throw new a;return i.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:t,decimals:s,image:r,symbol:n}}})}async setupListeners(){const e=await this.getProvider();e.on&&(e.on("accountsChanged",this.onAccountsChanged),e.on("chainChanged",this.onChainChanged),e.on("disconnect",this.onDisconnect))}isUserRejectedRequestError(e){return e.code===4001}injectedProvider(){return window?.ethereum}isInjected(){return!!this.injectedProvider()?.isFrame}async createProvider(){const e=(await _(()=>import("./browser.sqoLfEA9.js").then(t=>t.b),__vite__mapDeps([0,1,2,3]))).default;return e("frame")}}export{S as FrameConnector};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["_astro/browser.sqoLfEA9.js","_astro/index.hfxd0CuE.js","_astro/Login.jzdBbfpg.js","_astro/tokens.Ppa7r3iO.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
