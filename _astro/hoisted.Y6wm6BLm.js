import{L as d}from"./tokens.Ppa7r3iO.js";const L="https://cloudflare-ipfs.com/ipfs",h="https://api.thegraph.com/subgraphs/name/unlock-protocol",s="tkngate",r="tkninfo",i="tknacnt";function w(t){return"detail"in t}function S(t){return"detail"in t}function p(t){return e=>{const n=localStorage.getItem(r)||0;if(e&&e.detail&&e.detail==n)return t(e)}}async function E(t,e,n){const o={operationName:null,variables:{},query:`{
				keys(where: {owner: "${t.toLowerCase()}", lock: "${e.toLowerCase()}"}) {
					id
					lock {
						id
					}
					keyId
					tokenURI
				}
			}`};return(await fetch(`${h}/${n}`,{method:"POST",body:JSON.stringify(o)})).json()}const k=t=>{let e;return(...n)=>{e&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{t(...n)})}},u=()=>{document.documentElement.dataset.scroll=`${window.scrollY}`};document.addEventListener("scroll",k(u),{passive:!0});let c;function m(){c===void 0&&(c=document.getElementsByTagName("body")[0]),c.classList.toggle("loggedin")}async function I(t){const e=localStorage.getItem(s),n=localStorage.getItem(i);if(e!=null&&e!=null&&e==d&&n==t){const a=localStorage.getItem(r);document.dispatchEvent(new CustomEvent("ungate",{detail:a}));return}g(),(await E(t,d,"unlock"))?.data?.keys?.forEach(a=>{let l=(Math.random()+1).toString(36).substring(2);localStorage.setItem(r,l),localStorage.setItem(s,a.lock.id),localStorage.setItem(i,t),document.dispatchEvent(new CustomEvent("ungate",{detail:l}))})}function g(){localStorage.removeItem(r),localStorage.removeItem(s),localStorage.removeItem(i),document.dispatchEvent(new CustomEvent("gate"))}function f(t){if(!w(t))throw new Error("not a StringDetailEvent");m(),I(t.detail)}document.addEventListener("login",f);document.addEventListener("switch",f);document.addEventListener("logout",()=>{m(),g()});function v(t){if(!S(t))throw new Error("not a custom event");const e=document.querySelectorAll(".menu .gated");let n=o=>o.remove("show");p(o=>{o.detail&&(n=a=>a.add("show"))})(t);for(const o of e)n(o.classList)}document.addEventListener("ungate",v);document.addEventListener("gate",v);u();export{L as I,h as S};
